---
title: "Project One"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## MT5763 Software and Data Analysis **Due: 8th October**

Please find my GitHub repo here <https://github.com/selsiekiely/MT5763_1_190018562>.

### **Contents**
### Data Wrangling
###Data Visualisation
###Statistical Modelling

##**Data Wrangling**
## We will now data wrangle the BikeSeoul.csv

```{r, include = FALSE}
library(tidyverse)
library(readr)
BikeSeoul <- read_csv("~/Year 3/MT5763/BikeSeoul.csv")
View(BikeSeoul)
BikeWashington <- read_csv("~/Year 3/MT5763/BikeWashingtonDC.csv")
View(BikeWashington)
```

```{r BikeSeoul}
BikeSeoul <- BikeSeoul %>%
  select(- `Visibility (10m)`, -`Dew point temperature(C)`, -`Solar Radiation (MJ/m2)`, 
         -`Rainfall(mm)`, -`Snowfall (cm)`)
BikeSeoul <- BikeSeoul %>%  
  filter(!is.na(`Rented Bike Count`))
BikeSeoul <- BikeSeoul %>% 
  select(-`Functioning Day`)
library(lubridate)
BikeSeoul <- BikeSeoul %>%
  rename(Count = `Rented Bike Count`) %>%
  rename(Temperature = `Temperature(C)`) %>%
  rename(Humidity = `Humidity(%)`) %>%
  rename(WindSpeed = `Wind speed (m/s)`) %>%
  rename(Season = `Seasons`) %>%
  mutate(Date = as.Date(Date, format = "%d/%m/%Y"))
BikeSeoul <- BikeSeoul[!(BikeSeoul$Count == 0),]
year(BikeSeoul$Date) <- year(BikeSeoul$Date)
BikeSeoul <- BikeSeoul %>%
  mutate(BikeSeoul, FullDate = make_datetime(year = year(Date), month = month(Date), day = mday(Date), Hour)) %>%
  mutate(Temperature = as.numeric(Temperature))
BikeSeoul$Holiday <- ifelse(BikeSeoul$Holiday == "No Holiday", "No", "Yes")
yes_no_levels <- c("Yes", "No")
season_levels <- c("Spring", "Summer", "Autumn", "Winter")
BikeSeoul <- BikeSeoul %>%
  mutate(Holiday = factor(Holiday, levels = yes_no_levels),
         Season = factor(Season, levels = season_levels)) %>%
   arrange(Season, Holiday)
View(BikeSeoul)
```

```{r BikeWashington}
BikeWashington <- BikeWashington %>%
  select(-instant, -yr, -mnth, -weekday, -workingday, -weathersit, -atemp, -casual, -registered)
BikeWashington <- BikeWashington %>%
  rename(Date = dteday) %>%
  rename(Count = cnt) %>%
  rename(Hour = hr) %>%
  rename(Temperature = temp) %>%
  rename(Humidity = hum) %>%
  rename(WindSpeed = windspeed) %>%
  rename(Season = season) %>%
  rename(Holiday = holiday)
BikeWashington$Humidity <- paste(100*BikeWashington$Humidity)
BikeWashington$Temperature <- paste(47*BikeWashington$Temperature - 8)
BikeWashington$WindSpeed <- paste(67*(18/5)*BikeWashington$WindSpeed)
BikeWashington$Holiday <- ifelse(BikeWashington$Holiday == 0, "No", "Yes")
BikeWashington$Season <- ifelse(BikeWashington$Season == 1, "Winter", ifelse(BikeWashington$Season == 2, "Spring", ifelse(BikeWashington$Season == 3, "Summer", "Autumn")))
season_levels <- c("Spring", "Summer", "Autumn", "Winter")
yes_no_levels <- c("Yes", "No")
BikeWashington <- BikeWashington %>%
  mutate(Holiday = factor(Holiday, levels = yes_no_levels),
         Season = factor(Season, levels = season_levels)) %>%
   arrange(Season, Holiday)
BikeWashington$Date <- as.Date(BikeWashington$Date)
BikeWashington <- BikeWashington %>%
  mutate(BikeWashington, FullDate = make_datetime(year = year(Date), month = month(Date), day = mday(Date), Hour)) %>% 
  mutate(Temperature = as.numeric(Temperature)) %>%
  mutate(Humidity = as.numeric(Humidity)) %>%
  mutate(WindSpeed = as.numeric(WindSpeed))
View(BikeWashington)
```
# **Data Visualisation**
#### Before we start lets create a conjoined data set that contains a column of location
```{r, include = FALSE}
BikeSeoul <- BikeSeoul %>%
  mutate(BikeSeoul, Location = "Seoul")
BikeWashington <- BikeWashington %>%
  mutate(BikeWashington, Location = "Washington DC")
BikeWashingtonAndSeoul <- full_join(BikeSeoul, BikeWashington)
View(BikeWashingtonAndSeoul)
```
## How does air temperature vary over the course of a year?
### We will compute the data on separate graphs because Date is difficult to adjust with different year ranges. Using smooth will correctly adjust the daily pool of air temperatures that are recorded every hour.
##### **Note** that it is not possible to plot ggplots adjacent without installing gridExtra or ggpubr

```{r, include= FALSE}
library(dplyr)
library(ggplot2)

ggplot(BikeSeoul, aes(x = Date, y = Temperature))+
  geom_smooth() +
  labs(title = "Seoul Air Temperature over Time", x = "Time in days", y = "Air Temperature")

ggplot(BikeWashington, aes(x = Date, y = Temperature)) +
  geom_smooth() +
  labs(title = "Washington Air Temperature over Time", x = "Time in days", y = "Air Temperature")
```
#### In Seoul, over 2018 the temperature dips to roughly -4 in Late January/February and then peaks at roughly 30 in Late July/August before returning to 5 at the end of the year. In Washington, we follow a similar pattern; the temperature is lowest in January at roughly 2.5 and then peaks in July/August at roughly 23. Both peak and trough at similar points in the year; they follow a similar seasonal pattern. They differ such that Washington's temperature range is contained within Seoul's; Seoul experiences more dramatic temperature change. In terms of the data, we are given two years for Washington. It is noted that the pattern differs within Washington from year to year. Therefore, it would be good to collect more data for Seoul so we can be more confident about the comparisons we are making.

## How do Seasons affect the average number of rented bikes?
### I will find a daily average for rented bikes and compile this data to compare against Seasons in a plot.
```{r, include= FALSE}
Seoul_daily_count <- BikeSeoul %>%
  group_by(Date) %>%
  summarise(mn = mean(Count))
Washington_daily_count <- BikeWashington %>%
  group_by(Date) %>%
  summarise(mn = mean(Count))
Seoul_daily_count <- Seoul_daily_count %>%
  mutate(Seoul_daily_count, Location = "Seoul")
Washington_daily_count <- Washington_daily_count %>%
  mutate(Washington_daily_count, Location = "Washington DC")
Averaged_join <- full_join(Seoul_daily_count, Washington_daily_count)

ggplot(Averaged_join, aes(x = month(Date), y =mn, col = as.factor(Location))) +
  geom_smooth() +
  labs(title = "Seasons affect on average Bikes rented", x = "Day", y = "Average", col = "Location")
  
ggplot() +
  geom_smooth(Seoul_daily_count, mapping = aes(x = month(Date), y = mn), color='blue') +
  geom_smooth(Washington_daily_count, mapping = aes(x = month(Date), y = mn), color='red') +
  xlab("Date") + ylab("Average Bike Rent") +
    ggtitle("Average Bike Rent over Season change")
```
## Do Holidays increase or decrease the demand for rented bikes?
### Conjoin data sets and compare Yes/No holiday to month and rent count.

```{r, include=FALSE}
ggplot(BikeSeoul) +
  geom_point(mapping = aes(x = Date, y = Count))+
  facet_wrap(~Holiday)
ggplot(BikeWashington) +
  geom_point(mapping = aes(x = Date, y = Count)) +
  facet_wrap(~Holiday)
  
```
## How does the time of day affect the demand for rented bikes?
### I will use lubridate to pick out the time of day and plot this against count.

```{r, include=FALSE}
ggplot() +
  geom_point(BikeSeoul, mapping = aes(x= hour(FullDate), y = Count), color = 'green') +
  geom_point(BikeWashington, mapping = aes(x = hour(FullDate), y = Count), color = 'red')
```
## Is there an association between Bike demand and the three meteorological variables?
### Facet wrap Count vs. Three Meteorological Variables for each BikeSeoul and BikeWashington

```{r, include= FALSE}
ggplot(BikeSeoul) +
  geom_point(mapping = aes(x = Temperature, y = Count, color = 'blue'))+
  geom_point(mapping = aes(x = WindSpeed, y = Count, color = 'green'))+
  geom_point(mapping = aes(x = Humidity, y = Count, color = 'red'))
  
ggplot(BikeWashington) +
  geom_point(mapping = aes(x = Date, y = Count)) +
  facet_wrap(~Holiday)

```
## **Statistical Modelling**
### Firstly, we are required to fit a linear model

```{r, include = FALSE}
first_lm_Seoul <- lm(log(Count) ~ Season + Temperature + Humidity + WindSpeed, data = BikeSeoul)
first_lm_Washington <- lm(log(Count) ~ Season + Temperature + Humidity + WindSpeed, data = BikeWashington)
summary(first_lm_Seoul)
summary(first_lm_Washington)
```
## Next we will calculate Confidence Intervals for the regression coefficients
```{r, include=FALSE}
confint(first_lm_Seoul, level = 0.97)
confint(first_lm_Washington, level = 0.97)
```
## Calculate 90% **Prediction** intervals for Air Temperature(0 degrees celsius), Light Wind (0.5 m/s), Humidity 20%

```{r, include=FALSE}
aim_frame <- data.frame(Season = "Winter",
                        Temperature = 0,
                        WindSpeed = 0.5,
                        Humidity = 20)
predict(first_lm_Seoul, newdata = aim_frame, interval = "prediction")
predict(first_lm_Washington, newdata = aim_frame, interval = "prediction")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

